<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.0"><!-- Canonical URL --><link rel="canonical" href="https://blog.carlos8v.dev/blog/entendendo-crypto-com-javascript/"><!-- Primary Meta Tags --><title>Entendendo crypto com javascript</title><meta name="title" content="Entendendo crypto com javascript"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.carlos8v.dev/blog/entendendo-crypto-com-javascript/"><meta property="og:title" content="Entendendo crypto com javascript"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.carlos8v.dev/blog/entendendo-crypto-com-javascript/"><meta property="twitter:title" content="Entendendo crypto com javascript"><style>@import"https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap";:root{--text-primary: white;--text-secondary: #c8c8c8;--text-gray: #323542;--link-color: white;--primary: #3B49DF;--bg-primary: #15161b;--bg-secondary: #1e1f26;--border: #383b3e}*::-webkit-scrollbar{width:6px;height:6px}*::-webkit-scrollbar-thumb{background-color:#323542}*::-webkit-scrollbar-track{box-shadow:inset 0 0 6px #00000026}*{box-sizing:border-box;scroll-behavior:smooth;scroll-margin:70px 0 70px 0}html{font-size:16px}body{background:var(--bg-primary);font-family:Roboto,Arial,Helvetica,sans-serif;color:var(--text-primary);margin:0;padding:0;line-height:1.5rem}a{color:var(--link-color);text-decoration:none}a:hover{text-decoration:underline}hr{border:0;height:1px;background:var(--border);margin:30px 0}p{color:var(--text-secondary)}blockquote{margin:0;color:#6a737d;padding:0 16px;border-left:4px solid var(--text-secondary)}table{width:100%;border-collapse:collapse}table td,table th{padding:10px;border:1px solid var(--border)}table tr:nth-child(2n){background:var(--bg-secondary)}.main-wrapper{margin-top:60px;display:flex;padding:15px 30px;gap:15px 30px}.post-tag{display:inline-block;padding:5px;margin:5px 0;border-radius:4px;color:#fff;background:var(--text-gray);text-decoration:none}.main-footer{margin-top:30px;background:var(--text-primary);color:var(--text-secondary);border-bottom:4px solid var(--primary);display:flex;align-items:center;justify-content:center}@media (max-width: 600px){table{overflow:hidden;overflow-x:scroll;display:block;white-space:nowrap}.main-wrapper{padding:10px}}.main-header{position:fixed;top:0;width:100%;background:var(--bg-primary);border-bottom:1px solid var(--border);padding:10px}.main-header>nav{margin:0 auto;width:100%;max-width:1080px;display:flex;align-items:center;justify-content:space-between}.nav-list{display:none}.nav-link,.nav-link-mobile{font-size:.9rem;display:inline-block;color:#fff}.nav-link+.nav-link{margin-left:15px}.nav-mobile{position:absolute;top:18px;right:15px;width:24px;height:24px;fill:#fff;cursor:pointer}.nav-mobile path{transition:all .25s ease-out}.nav-mobile-active .nav-icon-top{transform:rotate(45deg) translateY(45%);transform-origin:center}.nav-mobile-active .nav-icon-middle{transform:translate(-2rem)}.nav-mobile-active .nav-icon-bottom{transform:rotate(-45deg) translateY(-45%);transform-origin:center}.nav-list-mobile{position:absolute;top:60px;overflow:hidden;background:var(--bg-secondary);left:0;width:100%;display:flex;flex-direction:column}:not(.nav-mobile-active)+.nav-list-mobile{height:0;opacity:0;transition:height .3s ease-in-out,opacity .15s ease-in}:is(.nav-mobile-active)+.nav-list-mobile{opacity:1;height:100vh;transition:height .3s ease-in-out,opacity .25s ease-in}.nav-link-mobile{padding:15px;border-bottom:1px solid var(--border)}@media (min-width: 600px){.main-header{padding:10px 30px}.nav-mobile{display:none}.nav-list{display:block}}
.post-container{width:100%;max-width:1080px;margin:0 auto}.post-content img{max-width:100%}.post-cover{width:100%;max-height:300px;object-fit:cover;object-position:center}.post-cover .top{object-position:top}.post-cover .center{object-position:center}.post-cover .bottom{object-position:bottom}.author-container{display:flex;align-items:center;gap:10px;margin-bottom:20px}.author-container>img{max-width:38px;border-radius:50%}.post-title{font-size:1.75rem;line-height:2rem;font-weight:500}.post-title>small{display:block;font-size:.9rem;color:var(--text-secondary);font-weight:400}@media (min-width: 600px){.post-cover{margin-top:15px}}:root{--comment: #6272a4;--default: #f8f8f2;--cyan: #8BE9FD;--green: #50FA7B;--orange: #FFB86C;--pink: #FF79C6;--purple: #BD93F9;--red: #FF5555;--yellow: #F1FA8C}code,pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}code[class*=language-],pre[class*=language-]{color:var(--default);background:none;text-shadow:0 1px rgba(0,0,0,.3);text-align:left;padding:0;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-],pre{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em;background:#1b1f230d}:not(pre)>code[class*=language-],pre[class*=language-]{background:#282a36}:not(pre)>code{padding:0 6px;font-size:.9rem;display:inline-block;border-radius:4px;background:#323542}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:var(--comment)}.token.punctuation{color:var(--default)}.namespace{opacity:.7}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:var(--pink)}.token.boolean,.token.number{color:var(--purple)}.token.selector,.token.string,.token.char,.token.builtin,.token.inserted{color:var(--yellow)}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:var(--default)}.token.atrule,.token.attr-value{color:var(--yellow)}.token.attr-name,.token.function{color:var(--green)}.language-bash .function,.language-shell .function{color:var(--default)}.token.class-name{color:var(--cyan)}.token.regex-flags,.token.keyword{color:var(--pink)}.token.regex-delimiter{color:var(--red)}.token.regex{color:var(--yellow)}.token.parameter,.token.important{color:var(--orange)}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media (max-width: 600px){code,pre{font-size:.9rem}}
</style><script type="module" src="/_astro/hoisted.C-EyyBPD.js"></script></head> <body> <header class="main-header"> <nav class="nav-container"> <a href="/"><img src="/favicon.svg"></a> <div class="nav-list"> <a href="/" class="nav-link">Home</a> <a href="https://github.com/carlos8v/blog" target="_blank" class="nav-link">Github</a> </div> </nav> <svg id="nav-mobile" class="nav-mobile" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 14"> <path class="nav-icon-top" d="M1 2a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2z"></path> <path class="nav-icon-middle" d="M1 8a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2z"></path> <path class="nav-icon-bottom" d="M1 14a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2z"></path> </svg> <div class="nav-list-mobile"> <a href="/" class="nav-link-mobile">Home</a> <a href="https://github.com/carlos8v/blog" target="_blank" class="nav-link-mobile">Github</a> </div>  </header>  <main class="main-wrapper"> <article class="post-container">  <div class="post-content"> <h1 class="post-title"> Entendendo crypto com javascript <small>Publicado em: <pub-date data-datetime="Fri Aug 09 2024 00:00:00 GMT+0000 (Coordinated Universal Time)"> <time id="pubDate" datetime="2024-08-09T00:00:00.000Z"></time> </pub-date> </small>  </h1> <hr>  <h1 id="objetivos">Objetivos üéØ</h1>
<p>Esclarecer conceitos de <em>crypto</em> utilizados em aplicativos de carteiras digitais e exemplificar como estes c√≥digos funcionam por debaixo dos panos.</p>
<blockquote>
<p>O post seguir√° os exemplos do site <a href="https://learnmeabitcoin.com/">learnmeabitcoin.com</a> feitos em ruby e ir√° portar-los para javascript (node).</p>
</blockquote>
<hr>
<h2 id="conceitos">Conceitos üìã</h2>
<p><strong>Frase Mnem√¥nica (Mnemonic Seed)</strong>:</p>
<p>√â uma frase contendo um conjunto de palavras que ser√£o usadas para cria√ß√£o/recupera√ß√£o de uma conta ou carteira digital.</p>
<p><strong>Semente (Seed):</strong></p>
<p>√â um valor alfanum√©rico gerado atrav√©s da frase mnem√¥nica.</p>
<p><strong>Chave p√∫blica e privada:</strong></p>
<p>S√£o chaves criadas atrav√©s de uma seed. A chave privada √© respons√°vel por assinar mensagens, e a p√∫blica √© respons√°vel por validar pacotes.</p>
<p><strong>Assinatura:</strong></p>
<p>Valor alfanum√©rico gerado com a a chave privada para garantir autenticidade de mensagens.</p>
<hr>
<h1 id="tutorial">Tutorial üî≠</h1>
<h3 id="passo-a-passo">Passo-a-passo:</h3>
<ol>
<li>Gerar frase mnem√¥nica;</li>
<li>Gerar seed;</li>
<li>Gerar chave p√∫blica e privada;</li>
<li>Assinar mensagem e verificar assinatura.</li>
</ol>
<h3 id="1-gerar-frase-mnem√¥nica">1. Gerar frase mnem√¥nica:</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { readFileSync } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'node:fs'</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { createHash, randomBytes } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'node:crypto'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Lista de palavras para seed</span></span>
<span class="line"><span style="color:#6A737D">// Seguir para exemplo https://github.com/bitcoin/bips/blob/master/bip-0039/portuguese.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Nesse exemplo, o arquivo `words.json` √© uma lista de palavras</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@example</span></span>
<span class="line"><span style="color:#6A737D"> * [</span></span>
<span class="line"><span style="color:#6A737D"> *  "abacate",</span></span>
<span class="line"><span style="color:#6A737D"> *  "abaixo",</span></span>
<span class="line"><span style="color:#6A737D"> *  ...</span></span>
<span class="line"><span style="color:#6A737D"> * ]</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> words</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">parse</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">readFileSync</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'./words.json'</span><span style="color:#E1E4E8">, { encoding: </span><span style="color:#9ECBFF">'utf-8'</span><span style="color:#E1E4E8"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Transforma buffer hexadecimal em array de bin√°rio</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {Buffer}</span><span style="color:#E1E4E8"> buf</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {string[]}</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@example</span></span>
<span class="line"><span style="color:#6A737D"> * const buffer = new Buffer().fill(0xb4)</span></span>
<span class="line"><span style="color:#6A737D"> * bufferToBinary(buffer) // -> ['10110100']</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#6A737D">// </span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> bufferToBinary</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">buf</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span></span>
<span class="line"><span style="color:#E1E4E8">  [</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">buf.</span><span style="color:#B392F0">values</span><span style="color:#E1E4E8">()].</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">byte</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> Number</span><span style="color:#E1E4E8">(byte).</span><span style="color:#B392F0">toString</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">padStart</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'0'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Calcular entropia inicial de 128 bits</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> bytes</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> randomBytes</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Organizar valor de entropia em array de bin√°rio</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> entropy</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> bufferToBinary</span><span style="color:#E1E4E8">(bytes)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Aplicar hash (SHA256) na entropia para criar checksum</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> hashedEntropy</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> bufferToBinary</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#B392F0">  createHash</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'sha256'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(entropy.</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">)).</span><span style="color:#B392F0">digest</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Recuperar a quantidade de bits necess√°ria para usar como checksum</span></span>
<span class="line"><span style="color:#6A737D">// Regra: 1bit a cada 32 bytes</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> size</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> entropy.</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">).</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> /</span><span style="color:#79B8FF"> 32</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> checksum</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> hashedEntropy.</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">slice</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, size)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Agrupar entropia + checksum em formato de 11bits</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> full</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">entropy, checksum]</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> pieces</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> full.</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">match</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">\d</span><span style="color:#F97583">{11}</span><span style="color:#9ECBFF">/</span><span style="color:#F97583">g</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Popular frase mnem√¥nica</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> sentence</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> piece</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> pieces </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> []) {</span></span>
<span class="line"><span style="color:#E1E4E8">  sentence.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(words[</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(piece, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Ex: entortar ramal ralado copeiro grunhido fretar inerente acima palheta minoria adentro granada</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Frase mnem√¥nica:'</span><span style="color:#E1E4E8">, sentence.</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">' '</span><span style="color:#E1E4E8">))</span></span>
<span class="line"></span></code></pre>
<h3 id="2-gerar-seed-atrav√©s-de-frase">2. Gerar seed atrav√©s de frase:</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { pbkdf2 } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'node:crypto'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Frase mnem√¥nica de exemplo</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> mnemonic</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> 'patente derramar secar edificar galho talher'</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> passphrase</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> ''</span><span style="color:#6A737D"> // Senha opcional</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> salt</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> `mnemonic${</span><span style="color:#E1E4E8">passphrase</span><span style="color:#9ECBFF">}`</span><span style="color:#6A737D"> // "mnemonic" (padr√£o) + senha</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> iterations</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 2048</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> keylength</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Utilizando pbkdf2 para criar uma seed de 64 bytes</span></span>
<span class="line"><span style="color:#B392F0">pbkdf2</span><span style="color:#E1E4E8">(mnemonic, salt, iterations, keylength, </span><span style="color:#9ECBFF">'sha512'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">derivedKey</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (err) </span><span style="color:#F97583">throw</span><span style="color:#E1E4E8"> err</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Mnemonic seed:'</span><span style="color:#E1E4E8">, derivedKey.</span><span style="color:#B392F0">toString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">)) </span><span style="color:#6A737D">// Ex: 'ee933c...8c5d00'</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<h3 id="3-gerar-chave-p√∫blica-e-privada-mestre">3. Gerar chave p√∫blica e privada mestre:</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { createHmac, createECDH } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'crypto'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Seed gerada atrav√©s de frase mnem√¥nica</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> seed</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#9ECBFF">  'ee933cc9789f0f3b2377883d193aa717961db37b317f798f9b2f7ad763fbda24'</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">  '115e37e4f7eca541f7feebdfafa8e8f9a20ea9f632710f155a63a1a6c88c5d00'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Criar hash (SHA512) de sua seed usando a seed da aplica√ß√£o como key</span></span>
<span class="line"><span style="color:#6A737D">// Ex: 'Bitcoin seed'</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> hmac</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createHmac</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'sha512'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Bitcoin seed'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(seed, </span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">digest</span><span style="color:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> masterPrivateKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> hmac.</span><span style="color:#B392F0">subarray</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> masterChainCode</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> hmac.</span><span style="color:#B392F0">subarray</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">64</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Gerar chaves p√∫blica e privada</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ecdh</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createECDH</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'secp256k1'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">ecdh.</span><span style="color:#B392F0">setPrivateKey</span><span style="color:#E1E4E8">(masterPrivateKey)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Chave privada:'</span><span style="color:#E1E4E8">, ecdh.</span><span style="color:#B392F0">getPrivateKey</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Chave p√∫blica:'</span><span style="color:#E1E4E8">, ecdh.</span><span style="color:#B392F0">getPublicKey</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'uncompressed'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"></span></code></pre>
<h3 id="4-assinar-dados-usando-ecdsa">4. Assinar dados usando ECDSA:</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  createSign,</span></span>
<span class="line"><span style="color:#E1E4E8">  createECDH,</span></span>
<span class="line"><span style="color:#E1E4E8">  createVerify,</span></span>
<span class="line"><span style="color:#E1E4E8">  createPublicKey,</span></span>
<span class="line"><span style="color:#E1E4E8">  createPrivateKey,</span></span>
<span class="line"><span style="color:#E1E4E8">} </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'node:crypto'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Criar objeto de chaves p√∫blica e privada</span></span>
<span class="line"><span style="color:#6A737D">// Refer√™ncia: https://zanechua.com/blog/generate-ec-private-public-key-pair-node/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Cria par de chaves p√∫blica e privada em formato der</span></span>
<span class="line"><span style="color:#6A737D"> *</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> rawPublicHexKey</span><span style="color:#6A737D"> hex</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> rawPrivateHexKey</span><span style="color:#6A737D"> hex</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> buildKeyPair</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rawPublicHexKey</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">rawPrivateHexKey</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> pubKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(rawPublicHexKey, </span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> privKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(rawPrivateHexKey, </span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> pubA</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">    '3056301006072A8648CE3D020106052B8104000A034200'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    'hex'</span></span>
<span class="line"><span style="color:#E1E4E8">  )</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> publicKeyDer</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">concat</span><span style="color:#E1E4E8">([pubA, pubKey])</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> publicKeyObject</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createPublicKey</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    key: publicKeyDer,</span></span>
<span class="line"><span style="color:#E1E4E8">    type: </span><span style="color:#9ECBFF">'spki'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    format: </span><span style="color:#9ECBFF">'der'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> privA</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'30740201010420'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> privB</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'A00706052B8104000AA144034200'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> privateKeyDer</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">concat</span><span style="color:#E1E4E8">([privA, privKey, privB, pubKey])</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> privateKeyObject</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createPrivateKey</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    type: </span><span style="color:#9ECBFF">'sec1'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    format: </span><span style="color:#9ECBFF">'der'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    key: privateKeyDer.</span><span style="color:#B392F0">toString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">    encoding: </span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> { publicKey: publicKeyObject, privateKey: privateKeyObject }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Recuperar chave privada mestre</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> masterPrivateKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Buffer.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  '07acbf6a29fc19b91d43d1bc9da2aa9588a1fd3fdad9c33681fee523c16f8d03'</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// Chave de exemplo</span></span>
<span class="line"><span style="color:#9ECBFF">  'hex'</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ecdh</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createECDH</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'secp256k1'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">ecdh.</span><span style="color:#B392F0">setPrivateKey</span><span style="color:#E1E4E8">(masterPrivateKey)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> rawPublicKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ecdh.</span><span style="color:#B392F0">getPublicKey</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'uncompressed'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> rawPrivateKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ecdh.</span><span style="color:#B392F0">getPrivateKey</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Criando par de chaves no formato der</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">publicKey</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">privateKey</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#B392F0"> buildKeyPair</span><span style="color:#E1E4E8">(rawPublicKey, rawPrivateKey)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Assinando mensagem</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> message</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> 'Hello world'</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> signature</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createSign</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'sha256'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(message).</span><span style="color:#B392F0">sign</span><span style="color:#E1E4E8">(privateKey)</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Assinatura:'</span><span style="color:#E1E4E8">, signature.</span><span style="color:#B392F0">toString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hex'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Verificando assinatura</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> isVerified</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> createVerify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'sha256'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(message)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(publicKey, signature)</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Verificado:'</span><span style="color:#E1E4E8">, isVerified)</span></span>
<span class="line"></span></code></pre>  </div> </article> </main>  </body></html>